groups:
  - name: HDFS
    rules:
    -  alert: NameNode进程存活
       expr: up{job="namenode"} != 1
       labels:
           alertLevel: 异常级别
           clusterId: 1
           serviceRoleName: HDFS_NAMENODE
           serviceName: HDFS
       annotations:
           alertAdvice: 查看日志，分析宕机原因，解决问题后重新启动
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: NameNodeRPC延迟[5m]
       expr: avg_over_time(Hadoop_NameNode_RpcProcessingTimeAvgTime{job="HDFS-NameNode"}[5m]) > 5
       labels:
           alertLevel: 异常级别
           clusterId: 1
           serviceRoleName: HDFS_NAMENODE
           serviceName: HDFS
       annotations:
           alertAdvice: 请检查网络流量使用情况
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: NameNodeRPC延迟[15m]
       expr: avg_over_time(Hadoop_NameNode_RpcProcessingTimeAvgTime{job="HDFS-NameNode"}[15m]) > 5
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: HDFS_NAMENODE
           serviceName: HDFS
       annotations:
           alertAdvice: 请检查网络流量使用情况
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: NameNode堆内存使用率
       expr: java_lang_Memory_HeapMemoryUsage_used{job="HDFS-NameNode"}*100/java_lang_Memory_HeapMemoryUsage_max{job="HDFS-NameNode"} > 95
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: HDFS_NAMENODE
           serviceName: HDFS
       annotations:
           alertAdvice: NameNode堆内存不足，增大NameNode堆内存
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: NameNode老年代GC持续时间[5m]
       expr: avg_over_time(Hadoop_NameNode_GcTimeMillisConcurrentMarkSweep{job="HDFS-NameNode"}[5m])/(5*60*1000) > 60
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: HDFS_NAMENODE
           serviceName: HDFS
       annotations:
           alertAdvice: 老年代GC时间过长，可考虑加大堆内存
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: NameNode新生代GC持续时间[5m]
       expr: avg_over_time(Hadoop_NameNode_GcTimeMillisParNew{job="HDFS-NameNode"}[5m])/(5*60*1000) > 60
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: HDFS_NAMENODE
           serviceName: HDFS
       annotations:
           alertAdvice: 新生代GC时间过长，可考虑加大堆内存
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: NameNodeGC持续时间[5m]
       expr: avg_over_time(Hadoop_NameNode_GcTimeMillis{job="HDFS-NameNode"}[5m])/(5*60*1000) > 60
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: HDFS_NAMENODE
           serviceName: HDFS
       annotations:
           alertAdvice: GC时间过长，可考虑加大堆内存
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: DataNode进程存活
       expr: up{job="datanode"} != 1
       labels:
           alertLevel: 异常级别
           clusterId: 1
           serviceRoleName: HDFS_DATANODE
           serviceName: HDFS
       annotations:
           alertAdvice: 查看日志，分析宕机原因，解决问题后重新启动
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: DataNodeRPC[5m]
       expr: avg_over_time(Hadoop_DataNode_RpcProcessingTimeAvgTime{job="HDFS-DataNode"}[5m]) > 5
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: HDFS_DATANODE
           serviceName: HDFS
       annotations:
           alertAdvice: 请检查网络流量使用情况
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: DataNodeRPC[15m]
       expr: avg_over_time(Hadoop_DataNode_RpcProcessingTimeAvgTime{job="HDFS-DataNode"}[15m]) > 5
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: HDFS_DATANODE
           serviceName: HDFS
       annotations:
           alertAdvice: 请检查网络流量使用情况
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: DataNode堆内存使用率
       expr: java_lang_Memory_HeapMemoryUsage_used{job="HDFS-DataNode"}*100/java_lang_Memory_HeapMemoryUsage_max{job="HDFS-DataNode"} > 95
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: HDFS_DATANODE
           serviceName: HDFS
       annotations:
           alertAdvice: NameNode堆内存不足，增大NameNode堆内存
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: DataNode老年代GC持续时间[5m]
       expr: avg_over_time(Hadoop_DataNode_GcTimeMillisConcurrentMarkSweep{job="HDFS-DataNode"}[5m])/(5*60*1000) > 60
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: HDFS_DATANODE
           serviceName: HDFS
       annotations:
           alertAdvice: 老年代GC时间过长，可考虑加大堆内存
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: DataNode新生代GC持续时间[5m]
       expr: avg_over_time(Hadoop_DataNode_GcTimeMillisParNew{job="HDFS-DataNode"}[5m])/(5*60*1000) > 60
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: HDFS_DATANODE
           serviceName: HDFS
       annotations:
           alertAdvice: 新生代GC时间过长，可考虑加大堆内存
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: DataNodeGC持续时间[5m]
       expr: avg_over_time(Hadoop_DataNode_GcTimeMillis{job="HDFS-DataNode"}[5m])/(5*60*1000) > 60
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: HDFS_DATANODE
           serviceName: HDFS
       annotations:
           alertAdvice: GC时间过长，可考虑加大堆内存
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: JournalNode进程存活
       expr: up{job="journalnode"} != 1
       labels:
           alertLevel: 异常级别
           clusterId: 1
           serviceRoleName: HDFS_JOURNALNODE
           serviceName: HDFS
       annotations:
           alertAdvice: JournalNode宕机，请重新启动
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: ZKFailoverController进程存活
       expr: up{job="zkfc"} != 1
       labels:
           alertLevel: 异常级别
           clusterId: 1
           serviceRoleName: ZKFC
           serviceName: HDFS
       annotations:
           alertAdvice: ZKFC宕机，请重新启动
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: HDFS坏盘
       expr: Hadoop_NameNode_VolumeFailuresTotal{name="FSNamesystem"} > 0
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: HDFS_NAMENODE
           serviceName: HDFS
       annotations:
           alertAdvice: 存在坏盘
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: HDFS块丢失
       expr: Hadoop_NameNode_MissingBlocks{name="FSNamesystem"} > 0
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: HDFS_NAMENODE
           serviceName: HDFS
       annotations:
           alertAdvice: 存在块丢失
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
