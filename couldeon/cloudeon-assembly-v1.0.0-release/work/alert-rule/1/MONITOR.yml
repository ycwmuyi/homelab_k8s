groups:
  - name: MONITOR
    rules:
    -  alert: 主机内存使用率
       expr: (1-(node_memory_MemAvailable_bytes/(node_memory_MemTotal_bytes)))*100 > 95
       labels:
           alertLevel: 异常级别
           clusterId: 1
           serviceRoleName: NODEEXPORTER
           serviceName: MONITOR
       annotations:
           alertAdvice: 1234
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: 主机CPU使用率
       expr: (1-avg(irate(node_cpu_seconds_total{mode="idle"}[5m]))by(instance))*100 > 95
       labels:
           alertLevel: 异常级别
           clusterId: 1
           serviceRoleName: NODEEXPORTER
           serviceName: MONITOR
       annotations:
           alertAdvice: 444
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: 主机CPU系统使用率
       expr: avg(irate(node_cpu_seconds_total{mode="system"}[5m]))by(instance)*100 > 95
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: NODEEXPORTER
           serviceName: MONITOR
       annotations:
           alertAdvice: cpu使用过高，评估是否有任务倾斜
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: 主机CPU用户使用率
       expr: avg(irate(node_cpu_seconds_total{mode="user"}[5m]))by(instance)*100 > 95
       labels:
           alertLevel: 异常级别
           clusterId: 1
           serviceRoleName: NODEEXPORTER
           serviceName: MONITOR
       annotations:
           alertAdvice: cpu使用过高，评估是否有任务倾斜
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: 主机磁盘IO使用率
       expr: avg(irate(node_cpu_seconds_total{mode="iowait"}[5m]))by(instance)*100 > 95
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: NODEEXPORTER
           serviceName: MONITOR
       annotations:
           alertAdvice: 磁盘IO过高，评估任务执行是否过于密集
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: 主机交换分区使用率
       expr: (1-((node_memory_SwapFree_bytes+1)/(node_memory_SwapTotal_bytes+1)))*100 > 95
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: NODEEXPORTER
           serviceName: MONITOR
       annotations:
           alertAdvice: 主机交换分区使用率过高，评估是否存在任务密集执行
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: 主机磁盘使用率
       expr: (node_filesystem_size_bytes{fstype=~"ext.*|xfs",mountpoint!~".*pod.*"}-node_filesystem_free_bytes{fstype=~"ext.*|xfs",mountpoint!~".*pod.*"})*100/(node_filesystem_avail_bytes{fstype=~"ext.*|xfs",mountpoint!~".*pod.*"}+(node_filesystem_size_bytes{fstype=~"ext.*|xfs",mountpoint!~".*pod.*"}-node_filesystem_free_bytes{fstype=~"ext.*|xfs",mountpoint!~".*pod.*"})) > 95
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: NODEEXPORTER
           serviceName: MONITOR
       annotations:
           alertAdvice: 1
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: 主机入网带宽
       expr: irate(node_network_receive_bytes_total[5m])*8 > 8589934592
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: NODEEXPORTER
           serviceName: MONITOR
       annotations:
           alertAdvice: 网络流量过高
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: 主机出网带宽
       expr: irate(node_network_transmit_bytes_total[5m])*8 > 8589934592
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: NODEEXPORTER
           serviceName: MONITOR
       annotations:
           alertAdvice: 网络流量过高
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: 系统平均负载[1m]
       expr: node_load1 > 100
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: NODEEXPORTER
           serviceName: MONITOR
       annotations:
           alertAdvice: 系统负载过高
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: 系统平均负载[5m]
       expr: node_load5 > 100
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: NODEEXPORTER
           serviceName: MONITOR
       annotations:
           alertAdvice: 系统负载过高
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: 系统平均负载[15m]
       expr: node_load15 > 100
       labels:
           alertLevel: 告警级别
           clusterId: 1
           serviceRoleName: NODEEXPORTER
           serviceName: MONITOR
       annotations:
           alertAdvice: 系统负载过高
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: AlertManager进程存活
       expr: up{job="alertmanager"} != 1
       labels:
           alertLevel: 异常级别
           clusterId: 1
           serviceRoleName: ALERTMANAGER
           serviceName: MONITOR
       annotations:
           alertAdvice: AlertManager宕机，请重新启动
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: Grafana进程存活
       expr: up{job="grafana"} != 1
       labels:
           alertLevel: 异常级别
           clusterId: 1
           serviceRoleName: GRAFANA
           serviceName: MONITOR
       annotations:
           alertAdvice: Grafana宕机，请重新启动
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: Prometheus进程存活
       expr: up{job="prometheus"} != 1
       labels:
           alertLevel: 异常级别
           clusterId: 1
           serviceRoleName: PROMETHEUS
           serviceName: MONITOR
       annotations:
           alertAdvice: Prometheus宕机，请重新启动
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
    -  alert: 主机状态
       expr: up{job="node_exporter"} != 1
       labels:
           alertLevel: 异常级别
           clusterId: 1
           serviceRoleName: NODEEXPORTER
           serviceName: MONITOR
       annotations:
           alertAdvice: 重新启动该服务器
           alertInfo:  "{{ $labels.job }}的{{ $labels.instance }}实例产生告警"
